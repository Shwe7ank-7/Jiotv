<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JioTV+</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  font-family: system-ui, Arial;
  background:#0b1220;
  color:#fff;
}

header {
  display:flex;
  align-items:center;
  justify-content:center;
  padding:14px;
  font-size:22px;
  font-weight:700;
  position:relative;
}

.menu-btn {
  position:absolute;
  left:14px;
  font-size:24px;
  cursor:pointer;
}

.theme-btn {
  position:absolute;
  right:14px;
  cursor:pointer;
}

.menu {
  position:fixed;
  top:0;
  left:-240px;
  width:220px;
  height:100%;
  background:#111827;
  padding:15px;
  transition:0.3s;
  z-index:999;
}

.menu.open { left:0; }

.menu button {
  width:100%;
  padding:10px;
  margin-bottom:8px;
  background:#1f2937;
  color:white;
  border:none;
  border-radius:8px;
  font-size:15px;
}

.grid {
  padding:15px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:14px;
}

.card {
  background:#162033;
  border-radius:16px;
  padding:14px;
  text-align:center;
  cursor:pointer;
}

.card img {
  width:80px;
  height:80px;
  object-fit:contain;
}

.card h3 {
  margin:10px 0 0;
  font-size:14px;
}
</style>
</head>

<body>

<header>
  <span class="menu-btn" onclick="toggleMenu()">â˜°</span>
  JioTV+
  <span class="theme-btn" onclick="toggleTheme()">ðŸŒ™</span>
</header>

<div class="menu" id="menu"></div>
<div class="grid" id="grid"></div>

<script>
let DATA = null;
let dark = true;

document.addEventListener("DOMContentLoaded", () => {
  loadData();
  setInterval(loadData, 120000); // auto refresh every 2 min
});

async function loadData() {
  try {
    const res = await fetch("channels.json", { cache: "no-store" });
    DATA = await res.json();
    buildMenu();
    renderChannels("All");
  } catch (e) {
    document.getElementById("grid").innerHTML =
      "<p style='text-align:center'>Failed to load channels</p>";
  }
}

function buildMenu() {
  const menu = document.getElementById("menu");
  menu.innerHTML = "";
  DATA.categories.forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = cat;
    btn.onclick = () => {
      renderChannels(cat);
      toggleMenu();
    };
    menu.appendChild(btn);
  });
}

function renderChannels(cat) {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  DATA.channels
    .filter(c => cat === "All" || c.category === cat)
    .forEach(ch => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <img src="${ch.logo}">
        <h3>${ch.name}</h3>
      `;
      div.onclick = () => {
        location.href = `watch.html?id=${ch.id}`;
      };
      grid.appendChild(div);
    });
}

function toggleMenu() {
  document.getElementById("menu").classList.toggle("open");
}

function toggleTheme() {
  dark = !dark;
  document.body.style.background = dark ? "#0b1220" : "#ffffff";
  document.body.style.color = dark ? "#ffffff" : "#000000";
}
</script>

</body>
</html>
