<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jiotv - @Shwe7ank</title>
<style>
  :root {
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --text-primary: #ffffff;
    --accent: #3b82f6;
  }
  body { margin: 0; font-family: sans-serif; background: var(--bg-primary); color: var(--text-primary); }
  
  /* Header */
  header {
    position: sticky; top: 0; z-index: 50;
    background: var(--bg-secondary);
    padding: 15px;
    display: flex; align-items: center; justify-content: space-between;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }
  .logo { font-weight: 800; font-size: 18px; color: #fff; letter-spacing: 0.5px; }

  /* Search */
  .search-container { padding: 15px; position: sticky; top: 60px; z-index: 40; background: var(--bg-primary); }
  input {
    width: 100%; padding: 12px; border-radius: 8px;
    border: 1px solid #334155; background: var(--bg-secondary);
    color: white; font-size: 16px; outline: none; box-sizing: border-box;
  }
  input:focus { border-color: var(--accent); }

  /* Grid */
  #grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 12px;
    padding: 15px;
  }
  
  .card {
    background: var(--bg-secondary);
    border-radius: 10px;
    overflow: hidden;
    cursor: pointer;
    position: relative;
    transition: transform 0.1s;
  }
  .card:active { transform: scale(0.96); }
  
  .card img {
    width: 100%;
    aspect-ratio: 16/9;
    object-fit: contain;
    background: #000;
    display: block;
  }
  
  .card-info { padding: 8px; text-align: center; }
  .card-title {
    font-size: 11px; font-weight: 600;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  
  /* Category Badge */
  .cat-badge {
    position: absolute; top: 0; right: 0;
    background: var(--accent); color: white;
    font-size: 9px; padding: 2px 6px;
    border-bottom-left-radius: 6px;
  }
  
  /* Loading */
  #loader { text-align: center; padding: 20px; color: #aaa; }
</style>
</head>
<body>

<header>
  <div class="logo">Jiotv - @Shwe7ank</div>
  <div onclick="location.reload()" style="cursor:pointer">â†»</div>
</header>

<div class="search-container">
  <input type="text" id="search" placeholder="Search Channels..." oninput="filterChannels()">
</div>

<div id="loader">Loading Channels...</div>
<div id="grid"></div>

<script>
// CONFIG
const M3U_URL = "https://raw.githubusercontent.com/alex8875/m3u/refs/heads/main/jstar.m3u";
let allChannels = [];

window.onload = async () => {
  try {
    const response = await fetch(M3U_URL);
    const data = await response.text();
    parseM3U(data);
  } catch (error) {
    document.getElementById('loader').innerText = "Error loading channels.";
  }
};

function parseM3U(data) {
  const lines = data.split('\n');
  let currentChannel = {};
  
  lines.forEach(line => {
    line = line.trim();
    if (line.startsWith('#EXTINF:')) {
      const logoMatch = line.match(/tvg-logo="([^"]*)"/);
      const groupMatch = line.match(/group-title="([^"]*)"/);
      const nameParts = line.split(',');
      const name = nameParts[nameParts.length - 1].trim();
      
      currentChannel = {
        name: name || "Unknown",
        logo: (logoMatch && logoMatch[1]) ? logoMatch[1] : "https://via.placeholder.com/150?text=No+Logo",
        category: (groupMatch && groupMatch[1]) ? groupMatch[1] : "TV"
      };
    } else if (line.startsWith('http')) {
      currentChannel.url = line;
      allChannels.push(currentChannel);
    }
  });
  
  document.getElementById('loader').style.display = 'none';
  renderChannels(allChannels);
}

function renderChannels(channels) {
  const grid = document.getElementById('grid');
  grid.innerHTML = "";
  
  // Limit to first 500 to prevent browser lag, or render all if needed
  channels.slice(0, 500).forEach(c => {
    const card = document.createElement('div');
    card.className = "card";
    // Encode URL to pass safely to player
    card.onclick = () => window.location.href = `watch.html?play=${encodeURIComponent(c.url)}`;
    
    card.innerHTML = `
      <div class="cat-badge">${c.category}</div>
      <img src="${c.logo}" loading="lazy" onerror="this.src='https://via.placeholder.com/150?text=TV'">
      <div class="card-info">
        <div class="card-title">${c.name}</div>
      </div>
    `;
    grid.appendChild(card);
  });
}

function filterChannels() {
  const query = document.getElementById('search').value.toLowerCase();
  const filtered = allChannels.filter(c => c.name.toLowerCase().includes(query));
  renderChannels(filtered);
}
</script>
</body>
</html>
