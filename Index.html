<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MOMIX JIOTV+</title>
<style>
  :root { --bg: #0f172a; --card: #1e293b; --text: #fff; --accent: #3b82f6; }
  body { margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, sans-serif; }
  
  /* Navbar */
  nav { position: sticky; top: 0; background: var(--card); padding: 15px; display: flex; justify-content: space-between; align-items: center; z-index: 50; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
  .logo { font-weight: 800; font-size: 1.2rem; letter-spacing: 1px; }
  
  /* Search */
  .search-box { padding: 15px; position: sticky; top: 60px; z-index: 40; background: var(--bg); }
  input { width: 100%; padding: 12px; background: var(--card); border: 1px solid #334155; color: white; border-radius: 8px; outline: none; box-sizing: border-box; }
  input:focus { border-color: var(--accent); }

  /* Grid */
  #grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 12px; padding: 15px; }
  .card { background: var(--card); border-radius: 10px; overflow: hidden; cursor: pointer; transition: transform 0.2s; position: relative; }
  .card:active { transform: scale(0.95); }
  .card img { width: 100%; aspect-ratio: 16/9; object-fit: contain; background: #000; display: block; }
  .card-name { padding: 10px; font-size: 0.8rem; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500; }
  .badge { position: absolute; top: 0; right: 0; background: var(--accent); font-size: 0.6rem; padding: 2px 6px; border-bottom-left-radius: 6px; }
  
  #loader { text-align: center; margin-top: 50px; color: #888; }
</style>
</head>
<body>

<nav>
  <div class="logo">MOMIX JIOTV+</div>
  <div onclick="location.reload()" style="cursor:pointer">â†»</div>
</nav>

<div class="search-box">
  <input type="text" id="search" placeholder="Search 800+ Live Channels..." oninput="filter()">
</div>

<div id="loader">Loading Channels...</div>
<div id="grid"></div>

<script>
const M3U = "https://raw.githubusercontent.com/alex8875/m3u/refs/heads/main/jstar.m3u";
let channels = [];

window.onload = async () => {
  try {
    const r = await fetch(M3U);
    const t = await r.text();
    parse(t);
  } catch (e) { document.getElementById('loader').innerText = "Failed to Load"; }
};

function parse(text) {
  const lines = text.split('\n');
  let current = {};
  
  lines.forEach(line => {
    line = line.trim();
    if (line.startsWith('#EXTINF:')) {
      const img = line.match(/tvg-logo="([^"]*)"/);
      const group = line.match(/group-title="([^"]*)"/);
      const name = line.split(',').pop().trim();
      current = { 
        name: name || "Channel", 
        logo: img ? img[1] : "", 
        group: group ? group[1] : "TV" 
      };
    } else if (line.startsWith('http')) {
      current.url = line;
      channels.push(current);
    }
  });
  document.getElementById('loader').style.display = 'none';
  render(channels);
}

function render(list) {
  const grid = document.getElementById('grid');
  grid.innerHTML = "";
  list.slice(0, 500).forEach(c => {
    const el = document.createElement('div');
    el.className = 'card';
    // IMPORTANT: Sending the URL to the player
    el.onclick = () => location.href = `watch.html?play=${encodeURIComponent(c.url)}`;
    el.innerHTML = `
      <div class="badge">${c.group}</div>
      <img src="${c.logo}" loading="lazy" onerror="this.src='https://via.placeholder.com/150?text=TV'">
      <div class="card-name">${c.name}</div>
    `;
    grid.appendChild(el);
  });
}

function filter() {
  const q = document.getElementById('search').value.toLowerCase();
  render(channels.filter(c => c.name.toLowerCase().includes(q)));
}
</script>
</body>
</html>
